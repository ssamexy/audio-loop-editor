<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Audio Loop Editor - 免費線上音訊分段剪輯與循環練習工具，支援毫秒精度、多段剪輯、試播放功能">
    <meta name="keywords" content="audio editor, loop practice, music practice, audio trimmer, segment editor">
    <title>Audio Loop Editor | 音訊分段剪輯與循環練習工具</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>🎵 Audio Loop Editor</h1>
            <p class="subtitle">音訊分段剪輯與循環練習工具 - 支援毫秒精度、多段剪輯、試播放</p>
            <div class="version">v1.4.3</div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- File Upload Section -->
            <section class="section file-upload-section">
                <div class="section-header-row">
                    <h2 data-i18n="select_audio">📁 選擇音訊檔案</h2>
                    <button id="btnPlayMain" class="btn btn-primary btn-play-main" title="播放主音訊" style="display: none;">
                        ▶ 播放
                    </button>
                    <div class="lang-switcher">
                        <button class="lang-btn" onclick="i18n.setLang('zh-TW')">中文</button>
                        <button class="lang-btn" onclick="i18n.setLang('en')">EN</button>
                    </div>
                </div>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept="audio/*" hidden>
                    <div class="upload-prompt">
                        <svg class="upload-icon" viewBox="0 0 24 24" width="48" height="48">
                            <path fill="currentColor" d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z" />
                        </svg>
                        <p>點擊或拖曳音訊檔案到此處</p>
                        <p class="upload-hint">支援 MP3, WAV, OGG, M4A 等格式</p>
                    </div>
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <div class="file-name" id="fileName"></div>
                        <div class="file-details" id="fileDetails"></div>
                    </div>
                </div>
                <!-- Hidden audio element for playback -->
                <audio id="audioPlayer" style="display: none;"></audio>
            </section>

            <!-- Settings Section -->
            <section class="section settings-section" id="settingsSection" style="display: none;">
                <h2 data-i18n="settings">⚙️ 設定</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="stepSize" data-i18n="step_size">時間微調刻度 (毫秒):</label>
                        <input type="number" id="stepSize" value="100" min="1" max="10000">
                        <div class="preset-buttons">
                            <button class="btn-preset" data-step="50">50ms</button>
                            <button class="btn-preset" data-step="100">100ms</button>
                            <button class="btn-preset" data-step="500">500ms</button>
                            <button class="btn-preset" data-step="1000">1000ms</button>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label data-i18n="auto_split">自動切分:</label>
                        <div class="auto-split-buttons">
                            <button class="btn-split" data-segments="2">2 <span data-i18n="segments">段</span></button>
                            <button class="btn-split" data-segments="3">3 <span data-i18n="segments">段</span></button>
                            <button class="btn-split" data-segments="4">4 <span data-i18n="segments">段</span></button>
                            <button class="btn-split" data-segments="5">5 <span data-i18n="segments">段</span></button>
                            <button class="btn-split" data-segments="6">6 <span data-i18n="segments">段</span></button>
                            <button class="btn-split" id="btnCustomSplit" data-i18n="other">其他...</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Segments Section -->
            <section class="section segments-section" id="segmentsSection" style="display: none;">
                <h2 data-i18n="segment_list">📋 分段列表</h2>
                <div class="segments-header">
                    <div class="segment-col-id" data-i18n="id">編號</div>
                    <div class="segment-col-name" data-i18n="segment_name">段落名稱</div>
                    <div class="segment-col-time" data-i18n="start_time">開始時間</div>
                    <div class="segment-col-time" data-i18n="end_time">結束時間</div>
                    <div class="segment-col-actions" data-i18n="actions">操作</div>
                </div>
                <div class="segments-list" id="segmentsList">
                    <!-- Segments will be added here dynamically -->
                </div>
                <div class="segments-controls">
                    <button class="btn btn-primary" id="btnAddSegment" data-i18n="add_segment">➕ 新增段落</button>
                    <button class="btn btn-secondary" id="btnImportJSON" data-i18n="import_settings">📥 匯入段落設定</button>
                    <button class="btn btn-secondary" id="btnExportJSON" data-i18n="export_settings">📤 匯出段落設定</button>
                    <button class="btn btn-danger" id="btnClearAll" data-i18n="clear_all">🗑 清除全部</button>
                </div>
            </section>

            <!-- Export Section -->
            <section class="section export-section" id="exportSection" style="display: none;">
                <h2 data-i18n="export_title">💾 匯出設定</h2>
                <div class="export-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="exportMp3" checked>
                        <span data-i18n="export_mp3">輸出為 MP3 (取消勾選則為 WAV)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="downloadZip" checked>
                        <span data-i18n="download_zip">打包成 ZIP (取消勾選則個別下載)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="keepOriginal" checked>
                        <span data-i18n="keep_original">同時保留完整版本</span>
                    </label>
                </div>
                <div class="export-controls">
                    <button class="btn btn-success btn-large" id="btnProcess">
                        🎵 開始剪輯
                    </button>
                </div>
                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">準備中...</div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>
                🎵 <strong>Audio Loop Editor</strong> - 專為音樂練習設計的分段剪輯工具
            </p>
            <p>
                <a href="https://github.com/ssamexy/audio-loop-editor" target="_blank">GitHub</a> |
                <a href="./DISCLAIMER.md" target="_blank">免責聲明</a> |
                所有處理都在您的瀏覽器中完成，不會上傳任何檔案
            </p>
            <p>&copy; 2026 ssamexy | MIT License</p>
        </footer>
    </div>

    <!-- Floating Player Bar -->
    <div class="floating-player-bar" id="floatingPlayerBar" style="display: none;">
        <div class="floating-player-controls">
            <button id="btnPlayPause" class="btn-player" title="播放/暫停">▶</button>
            <button id="btnLoop" class="btn-player" title="循環播放">🔁</button>
        </div>
        <div class="floating-player-seekbar">
            <input type="range" id="seekBar" class="seek-bar" min="0" max="100" value="0">
            <div class="floating-player-time">
                <span id="currentTime">00:00</span> / <span id="totalTime">00:00</span>
            </div>
        </div>
        <div class="floating-player-speed">
            <select id="playbackSpeed" class="speed-select" title="播放速度">
                <option value="0.5">x0.5</option>
                <option value="0.75">x0.75</option>
                <option value="1" selected>x1</option>
                <option value="1.25">x1.25</option>
                <option value="1.5">x1.5</option>
                <option value="2">x2</option>
            </select>
        </div>
        <div class="floating-player-mode">
            <label class="floating-checkbox-label">
                <input type="checkbox" id="segmentOnlyMode" checked>
                <span data-i18n="segment_only">僅段落</span>
            </label>
        </div>
        <div class="floating-player-info" id="floatingPlayerInfo">
            主音訊
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.1/lame.min.js"></script>

    <!-- Scripts -->
    <script src="js/time-utils.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/audio-processor.js"></script>
    <script src="js/segment-manager.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/app.js"></script>
</body>

</html>